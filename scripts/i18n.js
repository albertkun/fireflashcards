(function(){
  const dictionaries = {
    en: {
      'app.title': 'FireFlashcards',
      'tabs.dashboard': 'Dashboard',
      'tabs.add': 'Add',
      'tabs.quiz': 'Quiz',
      'tabs.list': 'List',
      'header.edit': 'Edit mode',
      'header.settings': 'Settings',
      'dashboard.progress': 'Progress',
      'dashboard.learned': 'Learned',
      'dashboard.accuracy': 'Accuracy',
      'dashboard.streak': 'Streak',
      'dashboard.days': 'days',
      'dashboard.dailyGoal': 'Daily goal',
      'dashboard.study': 'Study',
      'dashboard.startQuiz': 'Start Quiz',
      'dashboard.activity': 'Activity (last 28 days)',
      'dashboard.todayProgress': '{done}/{goal} today',
      'dashboard.due': '{count} due',
      'dashboard.recentSessions': 'Recent Study Sessions',
      'dashboard.thisWeek': 'This week',
      'dashboard.longestStreak': 'Longest streak',

      'add.word': 'Word',
      'add.translation': 'Translation',
      'add.pronunciation': 'Pronunciation (optional)',
      'add.reference': 'Reference URL (optional)',
      'add.hint': 'Hint (optional)',
      'add.add': 'Add',

      'quiz.reveal': 'Reveal',
      'quiz.good': 'Good',
      'quiz.again': 'Again',
      'quiz.openRef': 'Open reference',
      'quiz.allCaughtUp': 'All caught up!',
      'quiz.showHint': 'Show Hint',
      'quiz.hint': 'Hint',
      'quiz.tip': 'Try to recall the translation before flipping the card',
      'quiz.restart': 'Restart',
      'quiz.studyList': 'List',
      'quiz.missedTodayOnly': 'Missed today only',

      'list.reference': 'Reference',
      'list.lists': 'Lists',
      'list.placeholder.word': 'Word',
      'list.placeholder.translation': 'Translation',
      'list.placeholder.pronunciation': 'Pronunciation',
      'list.placeholder.reference': 'Reference URL',
      'list.placeholder.hint': 'Hint',
      'list.save': 'Save',
      'list.delete': 'Delete',
      'list.deleteConfirm': 'Delete this word?',
      'list.archive': 'Archive',
      'list.unarchive': 'Unarchive',
      'list.archived': 'Archived',
      'list.showArchived': 'Show archived',
      'list.selectAll': 'Select all',
      'list.moreOptions': 'More options ▾',
      'list.moreOptionsHide': 'Hide options ▴',
      'list.editModeBanner': 'Editing mode',

      'settings.title': 'Settings',
      'settings.languages': 'Languages',
      'settings.searchLanguages': 'Search languages',
      'settings.theme': 'Theme',
      'settings.theme.light': 'Light',
      'settings.theme.dark': 'Dark',
      'settings.theme.system': 'System',
      'settings.data': 'Data',
      'settings.exportWords': 'Export Words CSV',
      'settings.exportActivity': 'Export Activity CSV',
      'settings.appLanguage': 'App language',

      'lang.japanese': 'Japanese',
      'lang.thai': 'Thai',
      'lang.spanish': 'Spanish',
      'lang.korean': 'Korean',
      'lang.zh-TW': 'Chinese (Traditional)',

      // Lists manager
      'lists.title': 'Lists',
      'lists.new': 'New List',
      'lists.namePlaceholder': 'List name',
    },
    ja: {
      'app.title': 'FireFlashcards',
      'tabs.dashboard': 'ダッシュボード',
      'tabs.add': '追加',
      'tabs.quiz': 'クイズ',
      'tabs.list': '一覧',
      'header.edit': '編集モード',
      'header.settings': '設定',
      'dashboard.progress': '進捗',
      'dashboard.learned': '学習済み',
      'dashboard.accuracy': '正答率',
      'dashboard.streak': '連続日数',
      'dashboard.days': '日',
      'dashboard.dailyGoal': 'デイリー目標',
      'dashboard.study': '学習',
      'dashboard.startQuiz': 'クイズ開始',
      'dashboard.activity': 'アクティビティ（直近28日）',
      'dashboard.todayProgress': '{done}/{goal} 今日',
      'dashboard.due': '{count} 期限',
      'dashboard.recentSessions': '最近の学習セッション',
      'dashboard.thisWeek': '今週',
      'dashboard.longestStreak': '最長連続',

      'add.word': '単語',
      'add.translation': '訳',
      'add.pronunciation': '発音（任意）',
      'add.reference': '参考URL（任意）',
      'add.hint': 'ヒント（任意）',
      'add.add': '追加',

      'quiz.reveal': '表示',
      'quiz.good': '正解',
      'quiz.again': '再挑戦',
      'quiz.openRef': '参照を開く',
      'quiz.allCaughtUp': 'すべて完了！',
      'quiz.showHint': 'ヒントを表示',
      'quiz.hint': 'ヒント',
      'quiz.tip': 'カードをめくる前に訳を思い出してみましょう',
      'quiz.restart': 'リスタート',
      'quiz.studyList': 'リスト',
      'quiz.missedTodayOnly': '今日の間違いのみ',

      'list.reference': '参照',
      'list.lists': 'リスト',
      'list.placeholder.word': '単語',
      'list.placeholder.translation': '訳',
      'list.placeholder.pronunciation': '発音',
      'list.placeholder.reference': '参照URL',
      'list.placeholder.hint': 'ヒント',
      'list.save': '保存',
      'list.delete': '削除',
      'list.deleteConfirm': 'この単語を削除しますか？',
      'list.archive': 'アーカイブ',
      'list.unarchive': 'アーカイブ解除',
      'list.archived': 'アーカイブ済み',
      'list.showArchived': 'アーカイブを表示',
      'list.selectAll': 'すべて選択',
      'list.moreOptions': 'その他のオプション ▾',
      'list.moreOptionsHide': 'オプションを隠す ▴',
      'list.editModeBanner': '編集モード',

      'settings.title': '設定',
      'settings.languages': '言語',
      'settings.searchLanguages': '言語を検索',
      'settings.theme': 'テーマ',
      'settings.theme.light': 'ライト',
      'settings.theme.dark': 'ダーク',
      'settings.theme.system': 'システム',
      'settings.data': 'データ',
      'settings.exportWords': '単語CSVをエクスポート',
      'settings.exportActivity': '学習履歴CSVをエクスポート',
      'settings.appLanguage': 'アプリの言語',

      'lang.japanese': '日本語',
      'lang.thai': 'タイ語',
      'lang.spanish': 'スペイン語',
      'lang.korean': '韓国語',
      'lang.zh-TW': '中国語（繁体字）',

      // Lists manager
      'lists.title': 'リスト',
      'lists.new': '新しいリスト',
      'lists.namePlaceholder': 'リスト名',
    },
    th: {
      'app.title': 'FireFlashcards',
      'tabs.dashboard': 'แดชบอร์ด',
      'tabs.add': 'เพิ่ม',
      'tabs.quiz': 'แบบทดสอบ',
      'tabs.list': 'รายการ',
      'header.edit': 'โหมดแก้ไข',
      'header.settings': 'การตั้งค่า',
      'dashboard.progress': 'ความคืบหน้า',
      'dashboard.learned': 'เรียนแล้ว',
      'dashboard.accuracy': 'ความแม่นยำ',
      'dashboard.streak': 'สตรีค',
      'dashboard.days': 'วัน',
      'dashboard.dailyGoal': 'เป้าหมายรายวัน',
      'dashboard.study': 'ศึกษา',
      'dashboard.startQuiz': 'เริ่มแบบทดสอบ',
      'dashboard.activity': 'กิจกรรม (28 วันล่าสุด)',
      'dashboard.todayProgress': '{done}/{goal} วันนี้',
      'dashboard.due': '{count} ค้าง',
      'dashboard.recentSessions': 'เซสชันล่าสุด',
      'dashboard.thisWeek': 'สัปดาห์นี้',
      'dashboard.longestStreak': 'สตรีคที่ยาวที่สุด',

      'add.word': 'คำ',
      'add.translation': 'คำแปล',
      'add.pronunciation': 'การออกเสียง (ไม่บังคับ)',
      'add.reference': 'ลิงก์อ้างอิง (ไม่บังคับ)',
      'add.hint': 'คำใบ้ (ไม่บังคับ)',
      'add.add': 'เพิ่ม',

      'quiz.reveal': 'แสดง',
      'quiz.good': 'ถูก',
      'quiz.again': 'อีกครั้ง',
      'quiz.openRef': 'เปิดลิงก์อ้างอิง',
      'quiz.allCaughtUp': 'เรียบร้อยแล้ว!',
      'quiz.showHint': 'แสดงคำใบ้',
      'quiz.hint': 'คำใบ้',
      'quiz.tip': 'กลับมานึกคำแปลให้ได้ก่อนค่อยพลิกการ์ด',
      'quiz.restart': 'เริ่มใหม่',
      'quiz.studyList': 'รายการ',
      'quiz.missedTodayOnly': 'เฉพาะที่พลาดวันนี้',

      'list.reference': 'อ้างอิง',
      'list.lists': 'รายการ',
      'list.placeholder.word': 'คำ',
      'list.placeholder.translation': 'คำแปล',
      'list.placeholder.pronunciation': 'การออกเสียง',
      'list.placeholder.reference': 'ลิงก์อ้างอิง',
      'list.placeholder.hint': 'คำใบ้',
      'list.save': 'บันทึก',
      'list.delete': 'ลบ',
      'list.deleteConfirm': 'ลบคำนี้หรือไม่?',
      'list.archive': 'เก็บถาวร',
      'list.unarchive': 'เลิกเก็บถาวร',
      'list.archived': 'เก็บถาวรแล้ว',
      'list.showArchived': 'แสดงที่เก็บถาวร',
      'list.selectAll': 'เลือกทั้งหมด',
      'list.moreOptions': 'ตัวเลือกเพิ่มเติม ▾',
      'list.moreOptionsHide': 'ซ่อนตัวเลือก ▴',
      'list.editModeBanner': 'โหมดแก้ไข',

      'settings.title': 'การตั้งค่า',
      'settings.languages': 'ภาษา',
      'settings.searchLanguages': 'ค้นหาภาษา',
      'settings.theme': 'ธีม',
      'settings.theme.light': 'สว่าง',
      'settings.theme.dark': 'มืด',
      'settings.theme.system': 'ระบบ',
      'settings.data': 'ข้อมูล',
      'settings.exportWords': 'ส่งออกคำศัพท์ CSV',
      'settings.exportActivity': 'ส่งออกกิจกรรม CSV',
      'settings.appLanguage': 'ภาษาของแอป',

      'lang.japanese': 'ญี่ปุ่น',
      'lang.thai': 'ไทย',
      'lang.spanish': 'สเปน',
      'lang.korean': 'เกาหลี',
      'lang.zh-TW': 'จีนตัวเต็ม',

      // Lists manager
      'lists.title': 'รายการ',
      'lists.new': 'สร้างรายการ',
      'lists.namePlaceholder': 'ชื่อรายการ',
    },
    es: {
      'app.title': 'FireFlashcards',
      'tabs.dashboard': 'Panel',
      'tabs.add': 'Agregar',
      'tabs.quiz': 'Prueba',
      'tabs.list': 'Lista',
      'header.edit': 'Modo edición',
      'header.settings': 'Ajustes',
      'dashboard.progress': 'Progreso',
      'dashboard.learned': 'Aprendido',
      'dashboard.accuracy': 'Precisión',
      'dashboard.streak': 'Racha',
      'dashboard.days': 'días',
      'dashboard.dailyGoal': 'Meta diaria',
      'dashboard.study': 'Estudiar',
      'dashboard.startQuiz': 'Iniciar prueba',
      'dashboard.activity': 'Actividad (últimos 28 días)',
      'dashboard.todayProgress': '{done}/{goal} hoy',
      'dashboard.due': '{count} pendientes',
      'dashboard.recentSessions': 'Sesiones recientes',
      'dashboard.thisWeek': 'Esta semana',
      'dashboard.longestStreak': 'Racha más larga',

      'add.word': 'Palabra',
      'add.translation': 'Traducción',
      'add.pronunciation': 'Pronunciación (opcional)',
      'add.reference': 'URL de referencia (opcional)',
      'add.hint': 'Pista (opcional)',
      'add.add': 'Agregar',

      'quiz.reveal': 'Mostrar',
      'quiz.good': 'Bien',
      'quiz.again': 'Otra vez',
      'quiz.openRef': 'Abrir referencia',
      'quiz.allCaughtUp': '¡Todo al día!',
      'quiz.showHint': 'Mostrar pista',
      'quiz.hint': 'Pista',
      'quiz.tip': 'Intenta recordar la traducción antes de voltear la tarjeta',
      'quiz.restart': 'Reiniciar',
      'quiz.studyList': 'Lista',
      'quiz.missedTodayOnly': 'Solo falladas hoy',

      'list.reference': 'Referencia',
      'list.lists': 'Listas',
      'list.placeholder.word': 'Palabra',
      'list.placeholder.translation': 'Traducción',
      'list.placeholder.pronunciation': 'Pronunciación',
      'list.placeholder.reference': 'URL de referencia',
      'list.placeholder.hint': 'Pista',
      'list.save': 'Guardar',
      'list.delete': 'Eliminar',
      'list.deleteConfirm': '¿Eliminar esta palabra?',
      'list.archive': 'Archivar',
      'list.unarchive': 'Desarchivar',
      'list.archived': 'Archivado',
      'list.showArchived': 'Mostrar archivados',
      'list.selectAll': 'Seleccionar todo',
      'list.moreOptions': 'Más opciones ▾',
      'list.moreOptionsHide': 'Ocultar opciones ▴',
      'list.editModeBanner': 'Modo de edición',

      'settings.title': 'Ajustes',
      'settings.languages': 'Idiomas',
      'settings.searchLanguages': 'Buscar idiomas',
      'settings.theme': 'Tema',
      'settings.theme.light': 'Claro',
      'settings.theme.dark': 'Oscuro',
      'settings.theme.system': 'Sistema',
      'settings.data': 'Datos',
      'settings.exportWords': 'Exportar palabras CSV',
      'settings.exportActivity': 'Exportar actividad CSV',
      'settings.appLanguage': 'Idioma de la app',

      'lang.japanese': 'Japonés',
      'lang.thai': 'Tailandés',
      'lang.spanish': 'Español',
      'lang.korean': 'Coreano',
      'lang.zh-TW': 'Chino (Tradicional)',

      // Lists manager
      'lists.title': 'Listas',
      'lists.new': 'Nueva lista',
      'lists.namePlaceholder': 'Nombre de la lista',
    },
    ko: {
      'app.title': 'FireFlashcards',
      'tabs.dashboard': '대시보드',
      'tabs.add': '추가',
      'tabs.quiz': '퀴즈',
      'tabs.list': '목록',
      'header.edit': '편집 모드',
      'header.settings': '설정',
      'dashboard.progress': '진행',
      'dashboard.learned': '학습 완료',
      'dashboard.accuracy': '정확도',
      'dashboard.streak': '연속',
      'dashboard.days': '일',
      'dashboard.dailyGoal': '일일 목표',
      'dashboard.study': '학습',
      'dashboard.startQuiz': '퀴즈 시작',
      'dashboard.activity': '활동 (최근 28일)',
      'dashboard.todayProgress': '{done}/{goal} 오늘',
      'dashboard.due': '{count} 예정',
      'dashboard.recentSessions': '최근 학습 세션',
      'dashboard.thisWeek': '이번 주',
      'dashboard.longestStreak': '최장 연속',

      'add.word': '단어',
      'add.translation': '번역',
      'add.pronunciation': '발음 (선택 사항)',
      'add.reference': '참고 URL (선택 사항)',
      'add.hint': '힌트 (선택 사항)',
      'add.add': '추가',

      'quiz.reveal': '보기',
      'quiz.good': '좋음',
      'quiz.again': '다시',
      'quiz.openRef': '참고 열기',
      'quiz.allCaughtUp': '완료했습니다!',
      'quiz.showHint': '힌트 보기',
      'quiz.hint': '힌트',
      'quiz.tip': '카드를 뒤집기 전에 번역을 떠올려 보세요',
      'quiz.restart': '다시 시작',
      'quiz.studyList': '리스트',
      'quiz.missedTodayOnly': '오늘 틀린 것만',

      'list.reference': '참고',
      'list.lists': '리스트',
      'list.placeholder.word': '단어',
      'list.placeholder.translation': '번역',
      'list.placeholder.pronunciation': '발음',
      'list.placeholder.reference': '참고 URL',
      'list.placeholder.hint': '힌트',
      'list.save': '저장',
      'list.delete': '삭제',
      'list.deleteConfirm': '이 단어를 삭제할까요?',
      'list.archive': '보관',
      'list.unarchive': '보관 해제',
      'list.archived': '보관됨',
      'list.showArchived': '보관 항목 보기',
      'list.selectAll': '모두 선택',
      'list.moreOptions': '추가 옵션 ▾',
      'list.moreOptionsHide': '옵션 숨기기 ▴',
      'list.editModeBanner': '편집 모드',

      'settings.title': '설정',
      'settings.languages': '언어',
      'settings.searchLanguages': '언어 검색',
      'settings.theme': '테마',
      'settings.theme.light': '라이트',
      'settings.theme.dark': '다크',
      'settings.theme.system': '시스템',
      'settings.data': '데이터',
      'settings.exportWords': '단어 CSV 내보내기',
      'settings.exportActivity': '활동 CSV 내보내기',
      'settings.appLanguage': '앱 언어',

      'lang.japanese': '일본어',
      'lang.thai': '태국어',
      'lang.spanish': '스페인어',
      'lang.korean': '한국어',
      'lang.zh-TW': '중국어 (번체)',

      // Lists manager
      'lists.title': '리스트',
      'lists.new': '새 리스트',
      'lists.namePlaceholder': '리스트 이름',
    },
    'zh-TW': {
      'app.title': 'FireFlashcards',
      'tabs.dashboard': '儀表板',
      'tabs.add': '新增',
      'tabs.quiz': '測驗',
      'tabs.list': '清單',
      'header.edit': '編輯模式',
      'header.settings': '設定',
      'dashboard.progress': '進度',
      'dashboard.learned': '已學會',
      'dashboard.accuracy': '正確率',
      'dashboard.streak': '連續天數',
      'dashboard.days': '天',
      'dashboard.dailyGoal': '每日目標',
      'dashboard.study': '學習',
      'dashboard.startQuiz': '開始測驗',
      'dashboard.activity': '活動（最近 28 天）',
      'dashboard.todayProgress': '{done}/{goal} 今天',
      'dashboard.due': '{count} 到期',
      'dashboard.recentSessions': '最近的學習時段',
      'dashboard.thisWeek': '本週',
      'dashboard.longestStreak': '最長連續',

      'add.word': '單字',
      'add.translation': '翻譯',
      'add.pronunciation': '發音（可選）',
      'add.reference': '參考連結（可選）',
      'add.hint': '提示（可選）',
      'add.add': '新增',

      'quiz.reveal': '顯示',
      'quiz.good': '答對',
      'quiz.again': '再試一次',
      'quiz.openRef': '開啟參考',
      'quiz.allCaughtUp': '全部完成！',
      'quiz.showHint': '顯示提示',
      'quiz.hint': '提示',
      'quiz.tip': '翻卡之前先試著回想翻譯',
      'quiz.restart': '重新開始',
      'quiz.studyList': '清單',
      'quiz.missedTodayOnly': '僅限今日錯過',

      'list.reference': '參考',
      'list.lists': '清單',
      'list.placeholder.word': '單字',
      'list.placeholder.translation': '翻譯',
      'list.placeholder.pronunciation': '發音',
      'list.placeholder.reference': '參考連結',
      'list.placeholder.hint': '提示',
      'list.save': '儲存',
      'list.delete': '刪除',
      'list.deleteConfirm': '要刪除此單字嗎？',
      'list.archive': '封存',
      'list.unarchive': '取消封存',
      'list.archived': '已封存',
      'list.showArchived': '顯示已封存',
      'list.selectAll': '全選',
      'list.moreOptions': '更多選項 ▾',
      'list.moreOptionsHide': '隱藏選項 ▴',
      'list.editModeBanner': '編輯模式',

      'settings.title': '設定',
      'settings.languages': '語言',
      'settings.searchLanguages': '搜尋語言',
      'settings.theme': '主題',
      'settings.theme.light': '淺色',
      'settings.theme.dark': '深色',
      'settings.theme.system': '系統',
      'settings.data': '資料',
      'settings.exportWords': '匯出單字 CSV',
      'settings.exportActivity': '匯出活動 CSV',
      'settings.appLanguage': '應用程式語言',

      'lang.japanese': '日語',
      'lang.thai': '泰語',
      'lang.spanish': '西班牙語',
      'lang.korean': '韓語',
      'lang.zh-TW': '中文（繁體）',

      // Lists manager
      'lists.title': '清單',
      'lists.new': '新增清單',
      'lists.namePlaceholder': '清單名稱',
    }
  };

  let current = 'en';

  function titleCase(s){ return s.replace(/[-_.]/g,' ').replace(/\s+/g,' ').replace(/\b\w/g,c=>c.toUpperCase()); }

  // Fallback map for missing keys
  const fallbackMap = {
    'add.addButton': 'Add',
    'settings.targetLanguage': 'Target language',
    'settings.appLanguage': 'App language',
    'settings.theme': 'Theme',
    'settings.theme.system': 'System',
    'settings.theme.light': 'Light',
    'settings.theme.dark': 'Dark',
    'header.settings': 'Settings',
    'header.edit': 'Edit',
    'tabs.dashboard': 'Dashboard',
    'tabs.add': 'Add',
    'tabs.quiz': 'Quiz',
    'tabs.list': 'List',
    'list.save': 'Save',
    'list.delete': 'Delete',
    'list.deleteConfirm': 'Delete this entry?',
    'list.placeholder.word': 'Word',
    'list.placeholder.translation': 'Translation',
    'list.placeholder.pronunciation': 'Pronunciation',
    'list.placeholder.reference': 'Reference URL',
    'dashboard.dailyGoal': 'Daily goal',
    'dashboard.days': 'days',
    'dashboard.study': 'Study',
    'dashboard.recentSessions': 'Recent Study Sessions',
    'dashboard.activity': 'Activity (last 28 days)',
    'dashboard.learned': 'Learned',
    'dashboard.progress': 'Progress',
    'dashboard.accuracy': 'Accuracy',
    'quiz.reveal': 'Reveal',
    'quiz.again': 'Again',
    'quiz.good': 'Good',
    'quiz.tip': 'Try to recall the translation before flipping the card',
    'quiz.allCaughtUp': 'You are all caught up!',
    'quiz.restart': 'Restart',
    'lists.title': 'Lists',
    'lists.new': 'New List',
    'lists.namePlaceholder': 'List name',
    'list.archive': 'Archive',
    'list.unarchive': 'Unarchive',
    'list.archived': 'Archived',
    'list.showArchived': 'Show archived',
    'list.selectAll': 'Select all',
    'list.moreOptions': 'More options ▾',
    'list.moreOptionsHide': 'Hide options ▴',
  };

  function formatParams(str, params){
    if (!params) return str;
    let s = String(str);
    for (const k in params) s = s.replace(new RegExp(`\\{${k}\\}`, 'g'), String(params[k]));
    return s;
  }

  function t(key, params){
    const dict = dictionaries[current] || dictionaries.en || {};
    let out = (dict && dict[key]) || (dictionaries.en && dictionaries.en[key]);
    if (!out) out = fallbackMap[key] || titleCase(key.split('.').slice(-1)[0]);
    return formatParams(out, params);
  }
  function setLocale(locale){ current = locale || 'en'; try{ document.documentElement.setAttribute('lang', current); }catch(e){} }
  function getLocale(){ return current; }
  function apply(root){
    const scope = root || document;
    scope.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      const txt = t(key);
      if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
        if (el.hasAttribute('placeholder')) el.setAttribute('placeholder', txt);
        else el.value = txt;
      } else {
        el.textContent = txt;
      }
    });
  }

  if (!window.i18n) window.i18n = {};
  window.i18n.t = t;
  window.i18n.setLocale = setLocale;
  window.i18n.getLocale = getLocale;
  window.i18n.apply = apply;
})();
